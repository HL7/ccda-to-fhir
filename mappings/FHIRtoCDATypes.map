map "http://hl7.org/fhir/cda/mapping/fhirToCDATypes" = "Transform for FHIR types to CDA types"

uses "http://hl7.org/fhir/StructureDefinition/Identifier" as source
uses "http://hl7.org/fhir/cda/StructureDefinition/II" as target

group Any() {
  source.extension as ext where ext.url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor' -> target.nullFlavor as nullFlavor then {
    ext.value as v -> nullFlavor.value = cast(v, 'string');
  } "nullFlavor";
}

group Identifier(source source : Identifier, target target : II) extends Any <<types>> {
  source.system as system then {
    source.value as value then {
      value.value as v where system.value = 'urn:ietf:rfc:3986' -> target.root = cast(v, 'string') "noextension";
      system.value as v where system.value != 'urn:ietf:rfc:3986' -> target.root = v then {
        value.value as val -> target.extension = cast(val, 'string') "extension";
      } "withextension";
    } "rootValue";
  } "root";
  source.assigner as a then {
    a.display as display then {
      display.value as val -> target.assigningAuthorityName = cast(val, 'string');
    };
  };
  source.extension as ext where ext.url = 'http://hl7.org/fhir/cdaStructureDefinition/extension-displayable' -> target.displayable as displayable then {
    ext.value as v -> displayable.value = cast(v, 'string');
  } "displayable";
}

